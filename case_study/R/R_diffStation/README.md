In the folder of case_study/R/R_diffStation gives all the reproducible R scripts for my research project. 

## Data preprocessing

1. 
2. **0_preprocessData_allProcesses.R** preprocess the csv files created by the python in the previous step and create new csv files that can be used for implementing RFs later. In the script you can choose to preprocess data from either the calibrated PCR-GLOBWB model or the one with default parameterization.

## Implementing RF for all model configurations
**2_RF_allRFConfigurations.R** implements RFs to correct streamflow prediction errors in PCR-GLOBWB. 

At the top of the script you can choose 

1. to implement for the calibrated/uncalibrated PCR-GLOBWB model 
2. whether to include state variables as predictors in the random forests (by modifying the benchmark variable) 
3. whether to repeat two-fold cross-validation in parameter tuning (by modifying the repeatedCV variable) and the amout of repeat (by modifying the repeatCV variable). Note that it is recommended that there is no need to implement repeated two-fold cross-validation for the parameter tuning (leaving benchmark varaible as F) since it does not improve the performance of random forests much. 

This script runs for all the stations with data provided and implements the following processes:

    * tuning parameter and creating csv files of the tuning results (hyper_grid_[station].csv)
    * determining optimal parameters based on OOB RMSEs and cross-validation RMSEs
    * creating csv files of goodness of fit values using both PCR-GLOBWB predictions and ones updated by the random forests (rf_eval.csv giving absolute goodness-of-fit values and rf_eval_r.csv giving relative goodness-of-fit values)
    * creating csv files of variable importance results (variable_importance.csv)
    * creating csv files of streamflow predictions updated by the random forests (rf_result_[station].csv)

The csv files generated by the script will be put in the data/analysis folder and the results from different model configurations will be put in different subfolders.
## Visualizing results
**3_visualization_RF_allConfiguration.R** generates the barplot showing model performance of all model configurations (either pure PCR-GLOBWB or hybrid models with PCR-GLOBWB followed by RF error-correction). 
**3_visualize_hydrograph_all.R** generates not only time series plot of (observed & simulated) discharge and residuals for all configurations of the hybrid models but also scatterplots of residuals/predictions vs observations.
**3_visualize_hydrograph_all_calibr-wise.R**, unlike 3_visualize_hydrograph_all.R for the hybrid models, plots time series of (observed & simulated) discharge and residuals for the pure PCR-GLOBWB models (calibrated and uncalibrated). 

All the graphs generated by the above visualization scripts will be put in the graph/RFresult_all folder.

